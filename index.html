<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bug Simulator</title>
  <style>
    body { font-family: Inter, system-ui, sans-serif; padding: 2rem; line-height:1.5 }
    button { margin: .5rem; padding: .5rem 1rem; }
    .warning { color:blanchedalmond ; }
    .hidden { display:none; }
  </style>
</head>
<body>
  <h1>Bug simulator â€” index.html</h1>
  <p>Utilise les boutons pour provoquer des erreurs et regarde la console / onglet RÃ©seau / Application des DevTools.</p>

  <div>
    <button id="runtimeErr">ğŸª² Runtime error (handler)</button>
    <button id="unhandledRej">âŒ Unhandled Promise Rejection</button>
    <button id="networkFail">ğŸŒ RequÃªte rÃ©seau qui Ã©choue</button>
    <button id="missingRes">ğŸ”— Ressource manquante (404)</button>
    <button id="syntaxErr">ğŸ’¥ Syntax error via eval</button>
    <button id="lsCorrupt">ğŸ—„ï¸ Corrompre localStorage</button>
    <button id="slowResponse">ğŸ¢ Simuler lenteur (setTimeout)</button>
    <button id="infiniteLoop" class="warning">âš ï¸ CPU-bound (danger) â€” simul</button>
  </div>

  <hr/>

  <div id="results"></div>

  <script>
    // Helper pour afficher un message visible
    function show(msg) {
      const r = document.getElementById('results');
      const p = document.createElement('p');
      p.textContent = msg;
      r.appendChild(p);
    }

    // 1) Runtime error - exception non catchÃ©e dans un handler
    document.getElementById('runtimeErr').addEventListener('click', () => {
      show('Trigger: runtime error (voir console).');
      // erreur volontaire : appel d'une mÃ©thode sur null
      const el = null;
      el.doSomething(); // <-- TypeError
    });

    // 2) Unhandled Promise rejection
    document.getElementById('unhandledRej').addEventListener('click', () => {
      show('Trigger: unhandled promise rejection (voir console).');
      // Promesse rejetÃ©e sans catch
      Promise.reject(new Error('Simulated rejection â€” aucune gestion'));
    });

    // 3) RequÃªte rÃ©seau qui Ã©choue (fetch vers endpoint inexistant)
    document.getElementById('networkFail').addEventListener('click', async () => {
      show('Trigger: fetch vers API non disponible (voir RÃ©seau/Console).');
      try {
        const r = await fetch('https://127.0.0.1:9999/api/does-not-exist');
        show('Fetch response status: ' + r.status);
      } catch (err) {
        // on logue ici pour simuler un usage rÃ©el
        console.error('fetch failed:', err);
        show('Fetch a levÃ© une exception (voir console).');
      }
    });

    // 4) Ressource manquante -> 404 CSS/JS (charge un fichier qui n'existe pas)
    document.getElementById('missingRes').addEventListener('click', () => {
      show('Trigger: ajout dyn. dâ€™un script manquant (voir RÃ©seau).');
      const s = document.createElement('script');
      s.src = '/does-not-exist.js'; // 404
      document.body.appendChild(s);
    });

    // 5) Syntax Error via eval
    document.getElementById('syntaxErr').addEventListener('click', () => {
      show('Trigger: eval de code invalide (voir console).');
      try {
        eval('function ( {'); // syntaxe invalide -> SyntaxError
      } catch (err) {
        // note: catch empÃªche lâ€™erreur non gÃ©rÃ©e, mais tu peux aussi Ã©viter le try/catch pour produire une erreur globale
        console.error('Caught syntax error from eval:', err);
        show('Syntax error attrapÃ© dans le try/catch (console).');
      }
    });

    // 6) Corrompre localStorage (valeur attendue malformÃ©e)
    document.getElementById('lsCorrupt').addEventListener('click', () => {
      localStorage.setItem('auth', '{"accessToken": null, "expires": "not-a-date"}');
      show('localStorage mis Ã  jour avec valeur "corrompue" (onglet Application).');
      console.log('localStorage.auth =', localStorage.getItem('auth'));
    });

    // 7) Simuler lenteur de rÃ©ponse (setTimeout long)
    document.getElementById('slowResponse').addEventListener('click', () => {
      show('Trigger: opÃ©ration lente (simule dÃ©lai rÃ©seau).');
      const start = performance.now();
      // simulation sans bloquer le main thread
      setTimeout(() => {
        show('OpÃ©ration lente terminÃ©e aprÃ¨s 3s (mesure approx: ' + Math.round(performance.now() - start) + 'ms).');
      }, 3000);
    });

    // 8) CPU-bound "infinite loop" simulÃ©e (danger)
    document.getElementById('infiniteLoop').addEventListener('click', () => {
      show('Trigger: simulation CPU (utiliser avec prÃ©caution).');
      // pour Ã©viter de bloquer complÃ¨tement le navigateur, on fait une boucle partagÃ©e
      let i = 0;
      function chunk() {
        // boucle courte et rÃ©entrante via setTimeout pour Ã©viter freeze complet
        const limit = 5_000_00; // augmente pour plus de CPU
        for (let j = 0; j < limit; j++) { i++; Math.sqrt(j*i); }
        show('Progress: i=' + i);
        // relancer pour simuler travail long (arrÃªter manuellement en reloadant)
        setTimeout(chunk, 0);
      }
      chunk();
    });

    // Auto-trigger via query param ?bug=runtimeErr | unhandledRej | networkFail | missingRes | syntaxErr | lsCorrupt | slowResponse | infiniteLoop
    (function autoTrigger(){
      const qp = new URLSearchParams(location.search).get('bug');
      if (!qp) return;
      const map = {
        runtimeErr: 'runtimeErr',
        unhandledRej: 'unhandledRej',
        networkFail: 'networkFail',
        missingRes: 'missingRes',
        syntaxErr: 'syntaxErr',
        lsCorrupt: 'lsCorrupt',
        slowResponse: 'slowResponse',
        infiniteLoop: 'infiniteLoop'
      };
      const el = document.getElementById(map[qp]);
      if (el) setTimeout(()=>el.click(), 400);
    })();
  </script>
</body>
</html>

